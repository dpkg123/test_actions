name: deploy blog

on:

 workflow_dispatch:
 push:

jobs:

  deploy-blog: 
     runs-on: ubuntu-latest 
     steps:
     - name: vendor
       run: |
          git clone https://github.com/oppo-source/android_kernel_modules_oppo_mt6877/
          cp android_kernel_modules_oppo_mt6877/source ./ -R

     - name: Checkout Repo
       run: |
         wget https://github.com/dabao1955/android_kernel_OPPO_OP4ED5/archive/c7491e03f3b6545fb1cb75632b23f968b28812d0.tar.gz -O 1.tar.gz
         tar -xzf 1.tar.gz
         mv -v android_kernel_OPPO_OP4ED5* source/kernel-4.14

     - name: Setup environment
       uses: daaku/gh-action-apt-install@v4
       with:
         packages: libncurses5-dev libncurses-dev libssl-dev device-tree-compiler bc cpio lib32ncurses5-dev lib32z1 build-essential binutils bc bison build-essential ccache curl flex g++-multilib gcc-multilib git gnupg gperf imagemagick lib32ncurses5-dev lib32readline-dev lib32z1-dev liblz4-tool libncurses5 libncurses5-dev libsdl1.2-dev libssl-dev libxml2 libxml2-utils lzop pngcrush rsync schedtool squashfs-tools xsltproc zip zlib1g-dev git aria2 

     - name: Pull toolchain

       run: |

         cd $HOME

         git clone --depth=1 https://github.com/LineageOS/android_prebuilts_gcc_linux-x86_aarch64_aarch64-linux-android-4.9 aarch64-linux-android-4.9

         git clone --depth=1 https://github.com/LineageOS/android_prebuilts_gcc_linux-x86_arm_arm-linux-androideabi-4.9 arm-linux-androideabi-4.9

     - name: Pull clang

       run: |
          
          cd $HOME

          git clone https://github.com/dpkg123/clang --depth=2
     - run: cd source/kernel-4.14 && ls
     - run: cd source/kernel-4.14 && rm -rf KernelSU && curl -SsL https://github.com/tiann/kernelsu/raw/main/kernel/setup.sh | bash
     - run: cd source/kernel-4.14 && bash autotest_ksu.sh

