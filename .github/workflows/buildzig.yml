name: build zig

on:

  workflow_dispatch:
  push:

jobs:
  build-rootfs:
    runs-on: ubuntu-22.04
    permissions:
      contents: read
    steps:

    #- name: clean
    #  uses: rokibhasansagar/slimhub_actions@main
        
    - name: "Checkout Repo"
      uses: actions/checkout@v4
      with: 
        repository: ziglang/zig-bootstrap
        fetch-depth: 2
        path: rootfs/zig
    - name: Install package
      uses: NekoSekaiMoe/debchroot@v1
            
    - name: Checkout build files
      uses: actions/checkout@v4
      with:
        repository: dpkg123/zig-debian
        fetch-depth: 2
        path: rootfs/zig/debian

    - name: configure
      run: |
        rm rootfs/zig/build
        cp rootfs/zig/debian/build.sh rootfs/zig/build 
    - name: Build
      run: |        
        debsh "cd /zig/ && apt build-dep . -y && dpkg-buildpackage -b -us -uc"
