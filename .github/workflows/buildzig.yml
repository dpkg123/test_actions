name: build zig

on:

  workflow_dispatch:
  push:

jobs:
  build-rootfs:
    runs-on: ubuntu-22.04
    permissions:
      contents: read
    steps:

    - name: clean
      run: |
        test -f /bin/docker && docker rmi -f $(docker images -q)
        wget -q https://raw.githubusercontent.com/Homebrew/install/master/uninstall.sh && NONINTERACTIVE=1 bash ./uninstall.sh -f
        sudo apt update && sudo apt install python3 debhelper dpkg-dev make ninja-build -y

    - name: "Checkout Repo"
      uses: actions/checkout@v4
      with: 
        repository: ziglang/zig-bootstrap
        fetch-depth: 2
        
    - name: Checkout build files
      uses: actions/checkout@v4
      with:
        repository: dpkg123/zig-debian
        fetch-depth: 2
        path: debian

    - name: Build
      run: |
        rm build
        cp debian/build.sh ./build
        sudo dpkg-buildpackage -b -us -uc
