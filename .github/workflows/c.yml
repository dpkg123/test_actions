name: ci
on:
  pull_request:
  workflow_dispatch:
  push:
  
jobs:
  live-build:
    strategy:
      fail-fast: false
      matrix:
        include:
        - os: debian:bullseye
          id: gcc-10

        - os: debian:bookworm
          id: gcc-12

        - os: debian:sid
          id: gcc-13

    container: ${{ matrix.os }}
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:

 #   - uses: rokibhasansagar/slimhub_actions@main
    - uses: actions/checkout@v4
      with:
        repository: torvalds/linux
        fetch-depth: 10
    - run: apt-get update
    - run: apt-get -y install gcc-aarch64-linux-gnu g++-aarch64-linux-gnu bc bison flex build-essential python3 python3-pip binutils gcc git gzip libelf-dev libncurses5-dev libssl-dev openssl pahole perl-base rsync tar xz-utils make
    - run: mkdir -p -v output
    - run: export ARCH=arm64 && make defconfig -j4 && make -j4
    - uses: actions/upload-artifact@v3
      with:
        name: img
        path: output/*
